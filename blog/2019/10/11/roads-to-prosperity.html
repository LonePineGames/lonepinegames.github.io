<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>New Cities Friday Facts #3: Roads to Prosperity | New Cities</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="New Cities Friday Facts #3: Roads to Prosperity" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A stack interchange" />
<meta property="og:description" content="A stack interchange" />
<link rel="canonical" href="http://localhost:4000/blog/2019/10/11/roads-to-prosperity.html" />
<meta property="og:url" content="http://localhost:4000/blog/2019/10/11/roads-to-prosperity.html" />
<meta property="og:site_name" content="New Cities" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-11T00:00:00-07:00" />
<script type="application/ld+json">
{"headline":"New Cities Friday Facts #3: Roads to Prosperity","dateModified":"2019-10-11T00:00:00-07:00","datePublished":"2019-10-11T00:00:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/2019/10/11/roads-to-prosperity.html"},"description":"A stack interchange","@type":"BlogPosting","url":"http://localhost:4000/blog/2019/10/11/roads-to-prosperity.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-147711440-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-147711440-1');
  </script>

  <link rel="apple-touch-icon" sizes="180x180"
    href="/apple-touch-icon.png?v=Rymxjka8oz">
  <link rel="icon" type="image/png" sizes="32x32"
    href="/favicon-32x32.png?v=Rymxjka8oz">
  <link rel="icon" type="image/png" sizes="16x16"
    href="/favicon-16x16.png?v=Rymxjka8oz">
  <link rel="manifest" href="/site.webmanifest?v=Rymxjka8oz">
  <link rel="mask-icon" href="/safari-pinned-tab.svg?v=Rymxjka8oz"
    color="#61734a">
  <link rel="shortcut icon" href="/favicon.ico?v=Rymxjka8oz">
  <meta name="apple-mobile-web-app-title" content="New Cities">
  <meta name="application-name" content="New Cities">
  <meta name="msapplication-TileColor" content="#61734a">
  <meta name="theme-color" content="#61734a">

  <!-- fonts -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Play&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Days+One&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/blog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/blog/feed.xml" title="New Cities" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">
      <img class="site-icon" src="/blog/assets/images/house_icon.png"/>
    </a>
    <a class="site-title" rel="author" href="/blog/">
      New Cities
    </a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">New Cities Friday Facts #3: Roads to Prosperity</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-10-11T00:00:00-07:00" itemprop="datePublished">Oct 11, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <figure class="video caption-top ">
  <video autoplay="" loop="" controls="" poster="/blog/assets/images/interchange.png">
    <source src="https://github.com/LonePineGames/lonepinegames.github.io/releases/download/v0.3.0/interchange.mp4" />
    <source src="https://github.com/LonePineGames/lonepinegames.github.io/releases/download/v0.3.0/interchange.webm" />
  </video>
  <figcaption>A stack interchange</figcaption>
</figure>

<p>Cities are really about transportation. People choose where to live based on estimated travel time to work, school, or amenities. “Research<sup><a href="https://nascsp.org/wp-content/uploads/2018/02/issuebrief-benefitsofruralpublictransportation.pdf">[1]</a></sup> has shown that ease of access to transport has a stronger influence on whether someone will earn more than their parents did, than the level of crime in their area or whether they grew up in a two-parent household,” according to <a href="https://youtu.be/fwjwePe-HmA">Wendover Productions</a>.</p>

<p>New Cities features many kinds of roads, from tree-lined boulevards to high-speed expressways to traffic-corralling one way streets, from stop signs to stop lights to stack interchanges. But currently the only kinds of transportation in New Cities are private automobiles and freight trucks. There are no buses, bikes, pedestrians, trains, airplanes, boats, or even carpools – yet.</p>

<p>After the crowdfunding champaign, there will be a contributors-only vote to determine which new features to prioritize, and most of the candidate features will be related to transportation – so don’t worry, your inner train geek will be satisfied.</p>

<figure class="video caption-top caption-below">
  <video autoplay="" loop="" controls="" poster="/blog/assets/images/planner.png">
    <source src="https://github.com/LonePineGames/lonepinegames.github.io/releases/download/v0.3.0/planner.mp4" />
    <source src="https://github.com/LonePineGames/lonepinegames.github.io/releases/download/v0.3.0/planner.webm" />
  </video>
  <figcaption>Designing an expressway ramp in Planner Mode, which allows you to evaluate road designs before paying for them.</figcaption>
</figure>

<p>In order to lay the groundwork for these many modes of transit, I needed to refactor and improve “the graph.” The graph is the internal representation of the road system. In the language of <a href="https://en.wikipedia.org/wiki/Graph_theory">graph theory</a>, the intersections and junctions are “nodes” and the road segments connecting them are “edges”. Each edge connects two nodes, and each node to can connect up to six edges.</p>

<figure class="image caption-below">
  <a href="https://xkcd.com/2036/">
    <img src="/blog/assets/images/edgelord.png" alt="XKCD 2036" />
    <figcaption>XKCD 2036</figcaption>
  </a>
</figure>

<p>Currently, there are only roads and expressways, but in the future this system might represent train tracks, bus routes, airways, and sea lanes. Underneath the graph is the lane system, which tells vehicles where to go. Lanes are also used for routing. The lane system is managed automatically by the game based on modifications of the graph. Sidewalks, bike lanes and HOV lanes would be implemented as special kinds of lanes on roads and expressways.</p>

<p>When you place an edge (road), the game detects any place where that edge crosses another. It then “splits” both edges by placing a node (intersection) between them. When placing one segment of road, there might be a dozen splits or more.</p>

<p>But it gets even more complicated. The roads are split in order to conform to the elevation of terrain. Then there is Planner Mode, which allows you to plan roads before paying for them, and this means that splits must keep track of whether roads are completed or just planned.</p>

<figure class="video caption-top ">
  <video autoplay="" loop="" controls="" poster="/blog/assets/images/splits.png">
    <source src="https://github.com/LonePineGames/lonepinegames.github.io/releases/download/v0.3.0/splits.mp4" />
    <source src="https://github.com/LonePineGames/lonepinegames.github.io/releases/download/v0.3.0/splits.webm" />
  </video>
  <figcaption>How splits work</figcaption>
</figure>

<p>Once the splits are all resolved, intersections must be geometrically arranged, illegal states must be detected (underwater, too steep, etc), and costs must be computed. Terrain must be leveled, buildings must also be leveled, buildings and lots must be reassigned, new zone-able lots must be allocated, and the lane system must be updated. Finally, everything has to be rendered to screen.</p>

<p>The game has to do all of this in less than 16.667 milliseconds.</p>

<p>The graph was the very first thing I implemented, and therefore was most in need of a refactor. There were three issues I addressed with this refactor. Firstly, there were performance issues. I improved performance by making sure that things like rendering happened only once per frame, not once per split. (Performance issues are usually caused by redundant work.)</p>

<p>Secondly, it was possible to accidentally create duplicate, overlapping road segments (two roads connecting the same two intersections). This not only looked ugly but caused further glitches. Now when you overlap one road with another, it upgrades or modifies that section of road instead. In addition, building-by-overlap corrects the direction of one-way roads and expressways, meaning you can change the direction of a long stretch of one-way road using just two clicks – a really powerful tool.</p>

<figure class="video caption-top ">
  <video autoplay="" loop="" controls="" poster="/blog/assets/images/one-way-switch.png">
    <source src="https://github.com/LonePineGames/lonepinegames.github.io/releases/download/v0.3.0/one-way-switch.mp4" />
    <source src="https://github.com/LonePineGames/lonepinegames.github.io/releases/download/v0.3.0/one-way-switch.webm" />
  </video>
  <figcaption>Reversing the direction of a one-way road while upgrading it to four lanes and installing traffic lights -- all with just two clicks.</figcaption>
</figure>

<p>Thirdly, it was difficult to predict where intersections would happen. Sometimes roads would go under or over each other unexpectedly. When you actually did want an overpass, sometimes you’d get an intersection instead.  This was particularly frustrating when building expressways. Now the game computes and displays splits as you’re placing the road, making connection points clear. It also computes and displays an accurate price tag for the road you’re about to place.</p>

<p>Transportation is really at the core of New Cities, and building roads is part of the <a href="https://gameanalytics.com/blog/how-to-perfect-your-games-core-loop.html">core gameplay loop</a>. I’m very glad that I’ve made these improvements. This project is moving forward at HOV lane speeds, so I’m thankful that you’re riding carpool with me.</p>

<p>If you’re excited about the project, join the <a href="https://discord.gg/udgeB2E">discord</a> or <a href="https://www.reddit.com/r/New_Cities">subreddit</a>.</p>


  </div><a class="u-url" href="/blog/2019/10/11/roads-to-prosperity.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        New Cities
      </div>

      <div class="footer-col footer-col-2">
        <p>Build Prosperity.</p>
      </div>

      <div class="footer-col footer-col-3">
        <a href="/">lonepine.io</a>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
